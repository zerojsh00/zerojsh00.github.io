---
title: (K8S) ν…μΈνΈμ™€ ν†¨λ¬λ μ΄μ…
author: simon sanghyeon
date: 2022-08-14
categories: [Kubernetes]
tags: [Kubernetes, K8S, Scheduling, Taint, Toleration]
render_with_liquid: true
# use_math: true
---
μ΄ κΈ€μ€ Mumshad Mannambethκ°€ κ°•μν• Udemyμ Certified Kubernetes Administrator (CKA) with Practice Tests κ°•μ μ»¤λ¦¬νλΌμ„ ν† λ€λ΅ κ³µλ¶€ν• λ‚΄μ©μ„ μ •λ¦¬ν•μ€μμ„ λ°ν™λ‹λ‹¤.

---

μ΄λ² κΈ€μ—μ„λ” μ–΄λ–¤ νλ“λ¥Ό μ–΄λ–¤ λ…Έλ“μ— λ°°μΉν•λ”μ§€, μ¦‰ νλ“μ™€ λ…Έλ“ κ°„μ κ΄€κ³„λ¥Ό λ‹¤λ£¬λ‹¤.

# μ‚¬λμ—κ² λ“¤λ¬λ¶™μΌλ ¤λ” λ²λ λ΅ μ‚΄ν΄λ³΄λ” μ

ν…μΈνΈ(taint)μ™€ ν†¨λ¬λ μ΄μ…(toleration)μ κ΄€κ³„λ” μ²μ μ ‘ν•  λ• λ‹¤μ† λ³µμ΅ν•  μ μλ‹¤. λ”°λΌμ„ μ‚¬λμ—κ² μ ‘κ·Όν•λ” λ²λ μ μλ¥Ό λ“¤μ–΄μ„ μ„¤λ…ν•κ³ μ ν•λ‹¤.

- λ²λ κ°€ μ‚¬λμ—κ² μ¤λ” κ²ƒμ„ λ§‰κΈ° μ„ν•΄μ„ μ‚¬λλ“¤μ€ μ¤ν”„λ μ΄λ¥Ό λΏλ¦¬λ”λ°, μ΄ μ¤ν”„λ μ΄λ¥Ό `ν…μΈνΈ`λΌκ³  μƒκ°ν•μ.
- `λ²λ  A`λ” μ¤ν”„λ μ΄ λƒ„μƒλ¥Ό κµ‰μ¥ν μ‹«μ–΄ν•κΈ° λ•λ¬Έμ—, μ‚¬λμ—κ² μ ‘κ·Όν•λ©΄ μ¤ν”„λ μ΄(μ¦‰, ν…μΈνΈ) λƒ„μƒλ¥Ό λ§΅κ³  λ„λ§κ°€κ² λλ‹¤.
- ν•νΈ `λ²λ  B`λ” μ¤ν”„λ μ΄ λƒ„μƒλ¥Ό λ²„ν‹Έ μ(tolerant) μκΈ° λ•λ¬Έμ— μ‚¬λμ—κ² μ ‘κ·Όν•  μ μλ‹¤.

μ„ μμ—μ„ λ³΄λ“―, λ²λ κ°€ μ‚¬λμ—κ² λ“¤λ¬λ¶™μ„ μ μμΌλ ¤λ©΄ λ‘ κ°€μ§€κ°€ λ§μ΅±λμ–΄μ•Ό ν•λ‹¤.
1) μ‚¬λμ—κ² μ¤ν”„λ μ΄(μ¦‰, ν…μΈνΈ)κ°€ μ–Όλ§λ‚ λΏλ ¤μ Έ μλ”κ°€?
2) λ²λ λ” μ–Όλ§λ‚ μ¤ν”„λ μ΄(μ¦‰, ν…μΈνΈ) λƒ„μƒλ¥Ό λ²„ν‹Έ μ μλ”κ°€? (toleration)

μΏ λ²„λ„¤ν‹°μ¤μ— μ μ©ν•΄λ³΄λ©΄, `μ‚¬λ = λ…Έλ“`μ΄λ©°, `λ²λ  = νλ“`λ΅ λΉ„μ ν•  μ μλ‹¤. λν•, ν΄λ¬μ¤ν„° λ‚΄μ—μ„ `ν…μΈνΈ = security`μ™€ `ν†¨λ¬λ μ΄μ… = intrusion`μ΄λΌκ³  λΉ„μ ν•  μ μλ‹¤.

<aside>
π’΅ ν…μΈνΈμ™€ ν†¨λ¬λ μ΄μ…μ€ ν΄λ¬μ¤ν„° λ‚΄μ—μ„ μ–΄λ–¤ νλ“(λ²λ )κ°€ νΉμ • λ…Έλ“(μ‚¬λ)μ— μ¤μΌ€μ¤„λ§ λ  μ μλ„λ΅ μ ν•ν•λ” μ—­ν• μ„ ν•λ‹¤.
</aside>

---

# λ…Έλ“μ™€ νλ“μ—μ„μ ν…μΈνΈμ™€ ν†¨λ¬λ μ΄μ…

![fig01](/assets/img/2022-08-14-K8S_Taints and Tolerations/fig01.png)
*ν…μΈνΈμ™€ ν†¨λ¬λ μ΄μ…μ μ*

μ„ κ·Έλ¦Όκ³Ό κ°™μ΄ λ…Έλ“01μ— ν…μΈνΈκ°€ μ μ©λμ–΄ μλ‹¤λ©΄, ν•΄λ‹Ή ν…μΈνΈμ— ν†¨λ¬λ μ΄μ…μ΄ μλ” νλ“Dκ°€ μ•„λ‹κ³ μ„μ•Ό λ…Έλ“ 01μ— μ¤μΌ€μ¤„λ§ λ  μ μ—†λ‹¤.

![fig02](/assets/img/2022-08-14-K8S_Taints and Tolerations/fig02.png)
*ν…μΈνΈμ™€ ν†¨λ¬λ μ΄μ…μ„ μ μ©ν• ν›„, μ¤μΌ€μ¤„λ§λ κ²°κ³Όμ μμ‹1*

νΉν μ£Όμν•΄μ•Ό ν•  μ μ€, νλ“ Dκ°€ λ°λ“μ‹ ν†¨λ¬λ μ΄μ…μ΄ μλ‹¤κ³  ν•΄μ„ λ°λ“μ‹ ν•΄λ‹Ή λ…Έλ“μ— λ°°μΉλμ–΄μ•Όλ§ ν•λ” κ²ƒμ€ μ•„λ‹λ‹¤. μ¦‰, μ•„λμ™€ κ°™μ€ λ°°μΉκ°€ κ°€λ¥ν•λ‹¤λ” λ§μ΄λ‹¤.

![fig03](/assets/img/2022-08-14-K8S_Taints and Tolerations/fig03.png)
*ν…μΈνΈμ™€ ν†¨λ¬λ μ΄μ…μ„ μ μ©ν• ν›„, μ¤μΌ€μ¤„λ§λ κ²°κ³Όμ μμ‹2*

<aside>
π’΅ ν…μΈνΈμ™€ ν†¨λ¬λ μ΄μ…μ€ νΉμ • νλ“κ°€ λ°λ“μ‹ νΉμ • λ…Έλ“μ— μ„μΉν•΄μ•Όλ§ ν•λ‹¤κ³  μ§€μ •ν•λ” κ²ƒμ€ μ•„λ‹λ‹¤.
</aside>

---

## λ…λ Ήμ–΄λ΅ μ„¤μ •ν•λ” ν…μΈνΈ

`kubectl taint nodes <λ…Έλ“μ μ΄λ¦„> <ν‚¤ κ°’>=<λ°Έλ¥ κ°’>:<ν…μΈνΈ ν¨κ³Ό>` λ…λ Ήμ–΄λ¥Ό ν†µν•΄ μ„¤μ •ν•  μ μλ‹¤.

**ν…μΈνΈν¨κ³Ό**λ” μ•„λμ κ°’μ„ κ°€μ§ μ μλ‹¤.
  - `NoSchedule` : ν†¨λ¬λ μ΄μ… μ„¤μ •μ΄ μ—†μΌλ©΄ νλ“λ¥Ό μ¤μΌ€μ¤„λ§ ν•μ§€ μ•λ”λ‹¤. κΈ°μ΅΄μ— μ‹¤ν–‰λλ νλ“μ—λ” μ μ©λμ§€ μ•λ”λ‹¤.
  - `PreferNoSchedule` : ν†¨λ¬λ μ΄μ… μ„¤μ •μ΄ μ—†μΌλ©΄ νλ“λ¥Ό μ¤μΌ€μ¤„λ§ν•μ§€ μ•λ”λ‹¤. ν•μ§€λ§ ν΄λ¬μ¤ν„° μ• μμ›μ΄ λ¶€μ΅±ν•λ©΄ ν…μΈνΈλ¥Ό μ„¤μ •ν• λ…Έλ“μ—μ„λ„ νλ“λ¥Ό μ¤μΌ€μ¤„λ§ ν•  μ μλ‹¤. μ¦‰, ν•΄λ‹Ή λ…Έλ“μ— ν†¨λ¬λ μ΄μ…μ΄ μ—†λ” νλ“κ°€ ν•­μƒ μ¤μΌ€μ¤„λ§λλ” κ²ƒμ„ λ³΄μ¥ν•μ§€λ” μ•λ”λ‹¤.
  - `NoExecute` : ν†¨λ¬λ μ΄μ… μ„¤μ •μ΄ μ—†μΌλ©΄ νλ“λ¥Ό μ¤μΌ€μ¤„λ§ν•μ§€ μ•λ”λ‹¤. νΉν, κΈ°μ΅΄ νλ“λ„ ν†¨λ¬λ μ΄μ… μ„¤μ •μ΄ μ—†μΌλ©΄ μΆ…λ£μ‹ν‚¨λ‹¤.

```bash
$ kubectl taint nodes node01 app=grey:NoScedule
```

μ΄λ•, `app=grey`μ΄ μΌμΉν•λ” ν†¨λ¬λ μ΄μ…μ΄ μ—†μΌλ©΄ νλ“λ¥Ό node01μ— μ¤μΌ€μ¤„λ§ ν•  μ μ—†λ‹¤.

λν• ν…μΈνΈ μ μ© μ·¨μ† μ‹λ” β€-β€™ λ…λ Ήμ„ μ¶”κ°€ν•λ‹¤.

```bash
$ kubectl taint nodes node01 app=grey:NoScedule-
```


## νλ“ μ •μ YAMLλ΅ μ„¤μ •ν•λ” ν†¨λ¬λ μ΄μ…

```yaml
# pod-definition.yaml

apiVersion: v1
kind: Pod
metadata:
  name: myapp-pod
spec:
  containers:
  - name: nginx-container
    image: nginx
  tolerations: # ν†¨λ¬λ μ΄μ…μ΄ μ •μλλ” λ¶€λ¶„
  - key: "app" # ν…μΈνΈμ—μ„μ key κ°’
    operator: "Equal" # ν…μΈνΈμ—μ„μ "="μ— λ€μ‘λ¨
    value: "grey" # ν…μΈνΈμ—μ„μ value κ°’
    effect: "NoSchedule" # ν…μΈνΈ ν¨κ³Ό
```

---

# λ§μ¤ν„° λ…Έλ“μ— νλ“κ°€ λ°°μΉλμ§€ μ•λ” μ΄μ 

λ§μ¤ν„° λ…Έλ“μ— νλ“κ°€ λ°°μΉλμ§€ μ•λ” μ΄μ λ„ μ‚¬μ‹¤μ€ ν…μΈνΈ λ•λ¬Έμ΄λ‹¤. λ§μ¤ν„° λ…Έλ“λ” μΏ λ²„λ„¤ν‹°μ¤κ°€ μ²μ μ„¤μΉλ  λ• μλ™μ μΌλ΅ ν…μΈνΈκ°€ μ μ©λλ‹¤.
`kubectl describe node kubemaster | grep Taint` λ…λ Ήμ„ μΉλ©΄, λ§μ¤ν„° λ…Έλ“μ— ν…μΈνΈκ°€ μ μ©λμ–΄ μλ” κ²ƒμ„ ν™•μΈν•  μ μλ‹¤.

---

# μ°Έκ³  λ¬Έν—

[1] `Mumshad Mannambethμ κ°•μ` : [Certified Kubernetes Administrator (CKA) with Practice Tests](https://www.udemy.com/course/certified-kubernetes-administrator-with-practice-tests/)<br>
[2] `μ‹μ‘ν•μ„Έμ”! λ„μ»¤/μΏ λ²„λ„¤ν‹°μ¤ (μ©μ°¬νΈ μ§€μ)` : [μ‹μ‘ν•μ„Έμ”! λ„μ»¤/μΏ λ²„λ„¤ν‹°μ¤](http://www.yes24.com/Product/Goods/84927385)<br>
[3] `κΉ€μ§•μ–΄μ Devlog` : [[k8s] λ…Έλ“ μ¤μΌ€μ¥΄λ§ - Taintsμ™€ Toleratioin(ν…μΈνΈμ™€ ν†¨λ¬λ μ΄μ…)](https://kimjingo.tistory.com/146)
