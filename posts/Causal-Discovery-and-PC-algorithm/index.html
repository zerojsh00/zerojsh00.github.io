<!DOCTYPE html><html lang="ko" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Causal Discovery와 PC 알고리즘" /><meta name="author" content="simon sanghyeon" /><meta property="og:locale" content="ko" /><meta name="description" content="이 포스트는 개인적으로 공부한 내용을 정리하고 필요한 분들에게 지식을 공유하기 위해 작성되었습니다. 지적하실 내용이 있다면, 언제든 댓글 또는 메일로 알려주시기를 바랍니다." /><meta property="og:description" content="이 포스트는 개인적으로 공부한 내용을 정리하고 필요한 분들에게 지식을 공유하기 위해 작성되었습니다. 지적하실 내용이 있다면, 언제든 댓글 또는 메일로 알려주시기를 바랍니다." /><link rel="canonical" href="https://zerojsh00.github.io/posts/Causal-Discovery-and-PC-algorithm/" /><meta property="og:url" content="https://zerojsh00.github.io/posts/Causal-Discovery-and-PC-algorithm/" /><meta property="og:site_name" content="Simon’s Research Center" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-05-12T00:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Causal Discovery와 PC 알고리즘" /><meta name="twitter:site" content="@" /><meta name="twitter:creator" content="@simon sanghyeon" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"simon sanghyeon"},"dateModified":"2022-05-17T13:17:00+09:00","datePublished":"2022-05-12T00:00:00+09:00","description":"이 포스트는 개인적으로 공부한 내용을 정리하고 필요한 분들에게 지식을 공유하기 위해 작성되었습니다. 지적하실 내용이 있다면, 언제든 댓글 또는 메일로 알려주시기를 바랍니다.","headline":"Causal Discovery와 PC 알고리즘","mainEntityOfPage":{"@type":"WebPage","@id":"https://zerojsh00.github.io/posts/Causal-Discovery-and-PC-algorithm/"},"url":"https://zerojsh00.github.io/posts/Causal-Discovery-and-PC-algorithm/"}</script><title>Causal Discovery와 PC 알고리즘 | Simon's Research Center</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Simon's Research Center"><meta name="application-name" content="Simon's Research Center"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "AMS" } }, tex2jax: { inlineMath: [ ['$', '$'] ], displayMath: [ ['$$', '$$'] ], processEscapes: true, } }); MathJax.Hub.Register.MessageHook("Math Processing Error",function (message) { alert("Math Processing Error: "+message[1]); }); MathJax.Hub.Register.MessageHook("TeX Jax - parse error",function (message) { alert("Math Processing Error: "+message[1]); }); </script> <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"> </script><meta name="google-site-verification" content="J_a4XJ2oefe52p6EYvjTFdh9LW5Yc5RyGg1HpQOjWaA" /><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Simon's Research Center</a></div><div class="site-subtitle font-italic">성장하는 연구원의 공책</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/zerojsh00" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['zerojsh00','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Causal Discovery와 PC 알고리즘</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Causal Discovery와 PC 알고리즘</h1><div class="post-meta text-muted"><div> By <em> Sanghyeon </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1652281200" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-05-12 </em> </span> <span> Updated <em class="timeago" data-ts="1652761020" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-05-17 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3648 words"> <em>20 min</em> read</span></div></div></div><div class="post-content"><p>이 포스트는 개인적으로 공부한 내용을 정리하고 필요한 분들에게 지식을 공유하기 위해 작성되었습니다.<br /> 지적하실 내용이 있다면, 언제든 댓글 또는 메일로 알려주시기를 바랍니다.</p><blockquote><p>본 포스트의 상당 내용은 <a href="https://www.youtube.com/channel/UCkEHnPq2T8Vpafk3p-Rk49A"><code class="language-plaintext highlighter-rouge">인과추론의 데이터과학</code></a> 강의를 정리한 것임을 밝힙니다.</p></blockquote><h1 id="00-들어가며">00. 들어가며</h1><p>필자가 인과추론을 공부하기 시작한 이유는 클라우드 인프라 자원의 장애 발생에 대한 근본 원인을 탐지하는 기술을 연구하기 위해서입니다. 관련된 선행 연구를 보았을때, 많은 경우에 인프라 자원에 대하여 인과그래프를 구축하고,이를 대상으로 BFS/DFS 탐색을 하든 나름의 랭킹 알고리즘을 활용하든 하여 장애를 탐지하는 방식을 쓰는 것을 확인했습니다. 또, 특정 연구들은 인과그래프를 구축하기 위해서 PC 알고리즘이라는 것을 활용하기도 했습니다. 이러한 연구들을 파악하기 위해서 기본적인 인과추론에 대한 이해가 필요했었고, 인과추론이라는 새로운 영역을 공부하게 됐습니다. 그리고 드디어 인과그래프를 구축하기 위해서 많은 선행 연구들이 사용했던, 그리고 선행 연구를 보며 가장 궁금했던 PC 알고리즘을 다루고자 합니다.</p><h1 id="01-causal-discovery">01. Causal Discovery</h1><p><img data-src="/assets/img/2022-05-12-Causal%20Discovery%20and%20PC%20algorithm/causal structural learning.png" alt="causal_structural_learning" data-proofer-ignore></p><p>지금까지 공부했던 Structural Causal Model은 모두 잘 정의되어 있는 인과그래프가 이미 존재한다는 것을 전제로 하고 있습니다. 위 그림을 보겠습니다. 잘 정의되어 있는 인과그래프는 Joint Distribution으로 표현될 수 있습니다. 그리고 이러한 그래프와 Joint Distribution을 따르는 데이터를 활용하면 인과관계의 효과를 추정할 수 있습니다. 이러한 방식이 지금까지 공부했던 Structural Causal Model 입니다.</p><p>그런데 현실에서는 인과그래프를 구축하기 어려운 경우가 많습니다. 우리는 신이 아니기 때문에, 어떤 변수가 다른 변수에 어떻게 영향을 주는지 명확히 알기 어려운 것이죠. 이러한 문제가 Structural Causal Model의 한계점이기도 합니다. 즉, 완벽한 그래프가 주어진다면, 이론적으로 완벽한 인과적 효과를 계산할 수 있는 방법이긴 하지만, ‘완벽한 그래프’가 구축되기 어려우며, 상당한 도메인 지식도 필요로 할 것입니다.</p><p>이러한 문제를 어느정도 완화해줄 수 있는 방법이 있는데, <code class="language-plaintext highlighter-rouge">Causal Discovery</code>가 그것입니다. 그림에서 점선으로 표시된 화살표를 보겠습니다. Structural Causal Model의 역방향으로 흐르고 있죠. Causal Discovery는 Structural Causal Model과 반대로, 데이터가 존재할 때, 해당 데이터를 분석하여 데이터 내 Joint Distribution을 파악하고, 파악한 내용들로 인과그래프를 직접 도출하는 방식입니다. 이처럼 데이터를 활용해서 역으로 인과그래프의 구조 자체를 도출하는 방식이기에 <code class="language-plaintext highlighter-rouge">Structure Identification</code>이라고도 불립니다.</p><p><img data-src="/assets/img/2022-05-12-Causal%20Discovery%20and%20PC%20algorithm/overall_structure_of_causal_discovery.png" alt="overall_structure_of_causal_discovery" data-proofer-ignore></p><p>위의 장표는 Causal Discovery의 전체적인 구조를 보여줍니다. 우선, 데이터 상에 존재하는 변수들 간의 Joint Distribution을 이용해서 변수들이 독립인지, 종속인지를 파악해야 합니다. 그리고 몇 가지의 가정들을 만족했다는 전제하에 Causal Discovery 알고리즘을 돌립니다. 그러면 <code class="language-plaintext highlighter-rouge">Equivalence Class</code>라고 부르는 인과그래프가 도출됩니다. 이에 대해서 하나씩 살펴보겠습니다.</p><h1 id="02-causal-discovery를-위한-가정">02. Causal Discovery를 위한 가정</h1><p>Causal Discovery는 세 가지 가정이 필요합니다.</p><ul><li>Acyclicity (for DAG) Assumption<li>Causal Markov Assumption<li>Faithfulness Assumption</ul><p>Acyclicity 가정은 DAG 그래프를 활용하기 때문에 설명을 생략하고, 나머지 가정에 대해서 알아보겠습니다.</p><h2 id="causal-markov-assumption"><span class="mr-2">Causal Markov Assumption</span><a href="#causal-markov-assumption" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>확률 변수 $X_1$, $X_2$, $X_3$의 Joint Distribution은 $P(X_1, X_2, X_3)=P(X_1)P(X_2|X1)P(X_3|X_1,X_2)$로 표현할 수 있습니다. 만약 아래와 같이 그래프가 주어지면 어떨까요?</p><p><img data-src="/assets/img/2022-05-12-Causal%20Discovery%20and%20PC%20algorithm/causal_markov_assumption_graph.png" width="40%" data-proofer-ignore><br /></p><p><code class="language-plaintext highlighter-rouge">Causal Markov Assumption</code>은 이와 같이 인과그래프가 주어졌을 때, 특정 노드는 자신에게 직접적으로 영향을 주는 노드에게만 종속되며, 이외의 모든 노드들과는 독립이라는 가정입니다. 이를 수식으로 $P(X_1, X_2, X_3)=P(X_1)P(X_2|X1)P(X_3|X_2)$로 표현할 수 있습니다. 즉, $X_3$는 $X_2$에만 직접적인 영향을 받고, $X_1$으로부터는 간접적으로만 영향을 받기 때문에 수식의 $P(X_3|X_2)$ 부분이 바뀐 것을 볼 수 있습니다.</p><h2 id="faithfulness-assumption"><span class="mr-2">Faithfulness Assumption</span><a href="#faithfulness-assumption" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>아래와 같은 그래프를 가정해보겠습니다.</p><p><img data-src="/assets/img/2022-05-12-Causal%20Discovery%20and%20PC%20algorithm/faithfulness.png" alt="faithfulness" data-proofer-ignore></p><p>노드 $A$와 노드 $D$는 d-connected 되어있습니다. $A \rightarrow B \rightarrow D$의 경로와 $A \rightarrow C \rightarrow D$ 경로가 존재하기 때문이죠. 그런데 만약, $A \rightarrow B \rightarrow D$의 경로와 $A \rightarrow C \rightarrow D$ 경로가 각각 서로의 효과를 상쇄하는 정반대의 인과적 효과를 낸다면 어떻게 될까요? 예를 들어서, $A \rightarrow B \rightarrow D$의 경로는 $+1$의 인과적 효과를, $A \rightarrow C \rightarrow D$의 경로는 $-1$의 인과적 효과를 낸다면, 둘의 효과가 상쇄될 것입니다. <code class="language-plaintext highlighter-rouge">Faithfulness Assumption</code>은 이러한 효과는 존재하지 않으며, 따라서 경로 내에 있는 노드들은 반드시 종속적인 관계여야 한다고 가정합니다.</p><p>위와 같은 가정을 마쳤으면, Causal Discovery 알고리즘을 적용하여 인과 그래프를 도출할 수 있습니다.</p><h1 id="03-다양한-causal-discovery-알고리즘">03. 다양한 Causal Discovery 알고리즘</h1><p>인과 그래프를 도출할 수 있는 Causal Discovery 종류는 아래와 같이 굉장히 다양합니다.</p><p><img data-src="/assets/img/2022-05-12-Causal%20Discovery%20and%20PC%20algorithm/causal%20discovery%20algorithms.png" alt="causal discovery algorithms" data-proofer-ignore> <em>(참고) 이 표는 <a href="https://towardsdatascience.com/causal-discovery-6858f9af6dcb">여기</a>에서 가져왔습니다.</em></p><p>이들 중 어떠한 알고리즘이 특별히 다른 알고리즘보다 뛰어나다고 하기는 어렵습니다. 다만, 구현하는 방식에서의 디테일들이 다릅니다. 그리고 가장 유명한 알고리즘이자, 필자로 하여금 인과추론을 공부하게 했던 알고리즘이 바로 Conditional Independence 가정을 활용하는 <code class="language-plaintext highlighter-rouge">PC 알고리즘</code> 입니다.</p><p>PC 알고리즘을 이해하기 위해서 먼저 한 가지 더 알아야할 것이 있는데요. <code class="language-plaintext highlighter-rouge">Markov Equivalence Class</code>가 그것입니다.</p><h1 id="04-markov-equivalence-class">04. Markov Equivalence Class</h1><p><code class="language-plaintext highlighter-rouge">Markov Equivalence Class</code>란, 동일한 <code class="language-plaintext highlighter-rouge">skeleton</code>과 <code class="language-plaintext highlighter-rouge">V-structure</code>를 가지며, 동일한 Conditional Dependency를 가지는 그래프들의 집합으로 정의할 수 있습니다. 말이 어렵지만, 그림을 보며 이해하면 쉽게 알 수 있습니다.</p><p><img data-src="/assets/img/2022-05-12-Causal%20Discovery%20and%20PC%20algorithm/Markov Equivalence Class 01.png" alt="Markov Equivalence Class 01" data-proofer-ignore></p><p>위의 세 그래프는 모두 <code class="language-plaintext highlighter-rouge">동치(Equivalent)</code>하다고 할 수 있습니다. 왜냐하면, 세 그래프 모두 $X$와 $Z$ 및 $X$와 $Y$ 간의 관계는 직접적으로 연결되어 있어서 서로 Dependent하고, $Y$와 $Z$는 $X$를 통해서 연결되어 있어서 서로 Dependent하며, $X$를 Conditioning 하면 $Y$와 $Z$가 Conditionally Independent 해지는 구조이기 때문입니다.</p><p>이렇게 $X$, $Y$, 그리고 $Z$로 표현할 수 있는 모든 DAG 그래프는 다음과 같습니다.</p><p><img data-src="/assets/img/2022-05-12-Causal%20Discovery%20and%20PC%20algorithm/Markov%20Equivalence%20Class%2002.png" alt="Markov Equivalence Class 02" data-proofer-ignore></p><p>즉, 데이터의 Joint Distribution 내에 존재하는, 노드들 간 하나의 종속(또는 독립) 관계들로 그려낼 수 있는 동치 그래프가 이렇게 여러 개 존재한다는 것입니다. 문제는, 이와 같이 하나의 종속(또는 독립) 관계로 여러 그래프가 도출된다면, 이 중 어떤 그래프가 옳은 인과 그래프인지 특정할 수 없게됩니다.</p><p>여기서 빨간색 박스 부분을 주목해야 합니다. Collider로 V-structure를 이루고 있는 모양이죠. Collider 꼴로 이루어진 노드 간 종속 관계는 동치인 그래프가 여러 개 존재하지 않고, 단 하나의 그래프만이 존재합니다. 즉, Collider 꼴은 노드 간 종속(또는 독립) 관계를 확인할 수 있다면, 단 하나의 인과 그래프로 특정할 수 있는 구조라는 것입니다. 이러한 이유로 인해 Collider 구조는 Causal Discovery에서 핵심적인 역할을 합니다.</p><h1 id="05-pc-알고리즘">05. PC 알고리즘</h1><p>PC 알고리즘은 이를 개발한 Peter Spirtes와 Clark Glymour의 이름을 따서 만들어졌습니다. 이는 확률적으로 독립인 두 변수는 인과적으로 연결되어있지 않다는 아이디어를 기반으로 합니다. 앞서 Causal Discovery를 위한 가정과 Markov Equivalence Class 및 Collider(V-structure) 구조의 중요성을 인지했다면, PC 알고리즘 또한 쉽게 이해할 수 있습니다.</p><p>그럼, PC 알고리즘을 차근차근 살펴보겠습니다.</p><p><img data-src="/assets/img/2022-05-12-Causal%20Discovery%20and%20PC%20algorithm/GT.png" alt="GT" data-proofer-ignore> <em>Ground Truth 그래프</em></p><p>우리가 PC 알고리즘을 이용하여 궁극적으로 도출하고 싶은 Ground Truth 그래프는 위와 같다고 합시다.</p><h2 id="step-01"><span class="mr-2">STEP 01</span><a href="#step-01" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><img data-src="/assets/img/2022-05-12-Causal%20Discovery%20and%20PC%20algorithm/PC step 01.png" alt="PC step 01" data-proofer-ignore> <em>PC 알고리즘 STEP 01</em></p><p>첫번째 단계는 모든 노드들이 완전히 연결되어 있는 <code class="language-plaintext highlighter-rouge">Complete Undirected Graph</code>로 시작합니다.</p><h2 id="step-02"><span class="mr-2">STEP 02</span><a href="#step-02" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>두번째 단계에서는 노드 간 Conditionally Independent한지 여부를 확인하여 Unconditionally Independent한 노드 사이의 간선을 제거합니다. 예를 들어서, Ground Truth 그래프를 보았을 때, $X$와 $Y$는 어떠한 Conditioning을 수행하지 않는다 하더라도 서로 독립입니다. 이러한 관계를 Unconditionally Independent 하다고 표현합니다. 해당 노드 사이의 간선을 제거합니다. 그 결과는 다음과 같습니다.</p><p><img data-src="/assets/img/2022-05-12-Causal%20Discovery%20and%20PC%20algorithm/PC%20step%2002.png" alt="PC step 02" data-proofer-ignore> <em>PC 알고리즘 STEP 02</em></p><h2 id="step-03"><span class="mr-2">STEP 03</span><a href="#step-03" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>세번째 단계에서는 두 노드 간 다른 노드가 있는 경우, 사이에 있는 노드를 Conditioning 해보았을 때 두 노드가 Conditional Independent하다면, 두 노드 사이의 간선을 제거합니다. 예를 들어, STEP 02에서 $X-Z-W$ 경로에서 $Z$를 Conditioning 했더니 $X$와 $W$가 Independent 해졌다고 합시다. 그러면 $X-W$ 사이의 간선이 제거됩니다. 이러한 과정을 반복하고 나면, 아래 그림과 같이 <code class="language-plaintext highlighter-rouge">Skeleton</code>이라 부르는 뼈대가 형성됩니다.</p><p><img data-src="/assets/img/2022-05-12-Causal%20Discovery%20and%20PC%20algorithm/PC%20step%2003.png" alt="PC step 03" data-proofer-ignore> <em>PC 알고리즘 STEP 03, <code class="language-plaintext highlighter-rouge">Skeleton</code></em></p><h2 id="step-04"><span class="mr-2">STEP 04</span><a href="#step-04" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>네번째 단계에서는 Markov Equivalence Class에서 살펴보았던 V-structure 구조를 이용합니다. 앞서 보았듯, Collider의 V-structure 구조는 동치인 여러 그래프가 도출되는 것이 아닌 단 하나의 그래프만 도출됩니다. 이를 이용하여 Skeleton을 유향 그래프로 바꾸어 줍니다.</p><p>예를 들어, STEP 03의 Skeleton을 보면, ($X-Z$, $Y-Z$), ($Y-Z$, $W-Z$), ($X-Z$, $W-Z$) 쌍으로 $Z$를 향해 화살표를 그어봄으로써 Collider를 만들 수 있습니다. 그런데 이러한 경우의 수 중 ($Y \rightarrow Z$, $W \rightarrow Z$) 또는 ($X \rightarrow Z$, $W \rightarrow Z$)로 Collider를 만들 경우, $Z$를 Conditioning 했을 때, 두 노드 간 Dependency가 생기지 않고, Independent한 관계가 되기 때문에 Collider가 될 수 없습니다. 따라서 $Z$를 Conditioning 했을 때 두 노드인 $X$와 $Y$ 간 Dependency가 생기는 ($X \rightarrow Z$, $Y \rightarrow Z$) 구조로 Collider를 만들 수 있습니다.</p><p>이러한 방식으로 Collider를 만들어가면 아래와 같은 그래프가 나타납니다.</p><p><img data-src="/assets/img/2022-05-12-Causal%20Discovery%20and%20PC%20algorithm/PC%20step%2004.png" alt="PC step 04" data-proofer-ignore> <em>PC 알고리즘 STEP 04</em></p><h2 id="step-05"><span class="mr-2">STEP 05</span><a href="#step-05" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>마지막 절차는 <code class="language-plaintext highlighter-rouge">Orientation Propagation</code>으로 불립니다. 남아있는 무방향 간선들을 활용하여 Collider가 되지 않는 쪽으로 방향을 설정해줍니다. 그 결과 아래와 같이 Ground Truth와 유사한 인과 그래프를 도출할 수 있습니다.</p><p><img data-src="/assets/img/2022-05-12-Causal%20Discovery%20and%20PC%20algorithm/PC%20step%2005.png" alt="PC step 05" data-proofer-ignore> <em>PC 알고리즘 STEP 05</em></p><h1 id="06-pc-알고리즘-활용해보기">06. PC 알고리즘 활용해보기</h1><p>PC 알고리즘은 <a href="https://fentechsolutions.github.io/CausalDiscoveryToolbox/html/index.html">Causal Discovery Toolbox</a> 파이썬 라이브러리를 사용하여 돌려볼 수 있습니다. 다음 예제는 <a href="https://towardsdatascience.com/causal-discovery-6858f9af6dcb">여기</a>를 참고했음을 먼저 밝힙니다.</p><p>이 예제에서는 1994년 미국의 <a href="https://archive.ics.uci.edu/ml/datasets/census+income">Census Income Data Set</a> 데이터를 활용합니다. 데이터의 대략적인 생김새는 다음과 같습니다.</p><p><img data-src="/assets/img/2022-05-12-Causal%20Discovery%20and%20PC%20algorithm/census_dataset.png" alt="census_dataset" data-proofer-ignore></p><p>코드와 실행 결과는 다음과 같습니다.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>
<span class="c1"># 라이브러리를 임포트함
</span><span class="kn">import</span> <span class="n">pickle</span>
<span class="kn">import</span> <span class="n">cdt</span>
<span class="kn">import</span> <span class="n">networkx</span> <span class="k">as</span> <span class="n">nx</span>
<span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="c1"># 데이터를 불러옴
</span><span class="n">df</span> <span class="o">=</span> <span class="n">pickle</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span> <span class="nf">open</span><span class="p">(</span> <span class="s">"df_causal_discovery.p"</span><span class="p">,</span> <span class="s">"rb"</span><span class="p">)</span> <span class="p">)</span>

<span class="c1"># Skeleton 그래프를 그림
</span><span class="n">glasso</span> <span class="o">=</span> <span class="n">cdt</span><span class="p">.</span><span class="n">independence</span><span class="p">.</span><span class="n">graph</span><span class="p">.</span><span class="nc">Glasso</span><span class="p">()</span>
<span class="n">skeleton</span> <span class="o">=</span> <span class="n">glasso</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="c1"># 그래프를 시각화함
</span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">nx</span><span class="p">.</span><span class="nf">draw_networkx</span><span class="p">(</span><span class="n">skeleton</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">font_color</span><span class="o">=</span><span class="s">'r'</span><span class="p">)</span>
</pre></table></code></div></div><p><img data-src="/assets/img/2022-05-12-Causal%20Discovery%20and%20PC%20algorithm/result_skeleton.png" alt="result_skeleton" data-proofer-ignore></p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="c1"># Causal Discovery를 활용함
</span>
<span class="c1"># PC 알고리즘
</span><span class="n">model_pc</span> <span class="o">=</span> <span class="n">cdt</span><span class="p">.</span><span class="n">causality</span><span class="p">.</span><span class="n">graph</span><span class="p">.</span><span class="nc">PC</span><span class="p">()</span>
<span class="n">graph_pc</span> <span class="o">=</span> <span class="n">model_pc</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">skeleton</span><span class="p">)</span>

<span class="c1"># 그래프를 시각화함
</span><span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">nx</span><span class="p">.</span><span class="nf">draw_networkx</span><span class="p">(</span><span class="n">graph_pc</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">font_color</span><span class="o">=</span><span class="s">'r'</span><span class="p">)</span>
</pre></table></code></div></div><p><img data-src="/assets/img/2022-05-12-Causal%20Discovery%20and%20PC%20algorithm/result_PC.png" alt="result_PC" data-proofer-ignore></p><h1 id="07-정리하며">07. 정리하며</h1><p>이번 포스트에서는 Causal Discovery와 PC 알고리즘에 대해서 알아보았습니다. 인과 그래프를 먼저 구축한 후 인과관계를 추론하는 기존의 방법과는 달리, 데이터를 바탕으로 인과 그래프 자체를 도출하는 Causal Discovery는 아직도 학계에서 많은 연구가 이루어지고 있는 분야입니다.</p><p>아쉽게도 Causal Graph 자체를 정확하게 검증할 수 있는 방법은 세상에 없다고 합니다. 그만큼 훗날, Causal Discovery 방법론들이 이러한 한계점을 극복할 수 있는 대안이 될 수 있을 것입니다.</p><h1 id="참고자료">참고자료</h1><p>[1] <a href="https://www.youtube.com/channel/UCkEHnPq2T8Vpafk3p-Rk49A">인과추론의 데이터과학</a><br /> [2] Introduction to Causal Inference (Brady Neal)<br /> [3] <a href="https://towardsdatascience.com/causal-discovery-6858f9af6dcb">Causal Discovery- Shawhin Talebi의 블로그</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/causal-inference/'>Causal Inference</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/causal-inference/" class="post-tag no-text-decoration" >Causal Inference</a> <a href="/tags/causal-discovery/" class="post-tag no-text-decoration" >Causal Discovery</a> <a href="/tags/root-cause-analysis/" class="post-tag no-text-decoration" >Root Cause Analysis</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Causal+Discovery%EC%99%80+PC+%EC%95%8C%EA%B3%A0%EB%A6%AC%EC%A6%98+-+Simon%27s+Research+Center&url=https%3A%2F%2Fzerojsh00.github.io%2Fposts%2FCausal-Discovery-and-PC-algorithm%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Causal+Discovery%EC%99%80+PC+%EC%95%8C%EA%B3%A0%EB%A6%AC%EC%A6%98+-+Simon%27s+Research+Center&u=https%3A%2F%2Fzerojsh00.github.io%2Fposts%2FCausal-Discovery-and-PC-algorithm%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fzerojsh00.github.io%2Fposts%2FCausal-Discovery-and-PC-algorithm%2F&text=Causal+Discovery%EC%99%80+PC+%EC%95%8C%EA%B3%A0%EB%A6%AC%EC%A6%98+-+Simon%27s+Research+Center" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div><script src="https://utteranc.es/client.js" repo="zerojsh00/zerojsh00.github.io" issue-term="pathname" theme="github-light" crossorigin="anonymous" async> </script></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Network-Policy/">(K8S) 네트워크 정책(Network Policy) 기초 개념</a><li><a href="/posts/CNI-Weave/">(K8S) CNI Weave의 기초 개념</a><li><a href="/posts/Container-Networking-Interface/">(K8S) 네트워크 기초 정리 - CNI</a><li><a href="/posts/Storage-in-Docker/">(K8S) 도커의 스토리지(Storage in Docker)</a><li><a href="/posts/Security-Context/">(K8S) Security Context</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/k8s/">K8S</a> <a class="post-tag" href="/tags/kubernetes/">Kubernetes</a> <a class="post-tag" href="/tags/paper-review/">Paper Review</a> <a class="post-tag" href="/tags/security/">Security</a> <a class="post-tag" href="/tags/network/">Network</a> <a class="post-tag" href="/tags/speech-ai/">Speech AI</a> <a class="post-tag" href="/tags/scheduling/">Scheduling</a> <a class="post-tag" href="/tags/nlp/">NLP</a> <a class="post-tag" href="/tags/storage/">Storage</a> <a class="post-tag" href="/tags/asr/">ASR</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Causal-Inference-01/"><div class="card-body"> <em class="timeago small" data-ts="1651417200" > 2022-05-02 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>공부하며 정리하는 인과추론 01</h3><div class="text-muted small"><p> 이 포스트는 개인적으로 공부한 내용을 정리하고 필요한 분들에게 지식을 공유하기 위해 작성되었습니다. 지적하실 내용이 있다면, 언제든 댓글 또는 메일로 알려주시기를 바랍니다. 본 포스트의 상당 내용은 인과추론의 데이터과학 강의를 정리한 것임을 밝힙니다. 인과추론을 통해 달성하고자 하는 것 IT 운영 관리에서의 근본원인분석 과거에는 소프트웨어를...</p></div></div></a></div><div class="card"> <a href="/posts/Causal-Inference-02/"><div class="card-body"> <em class="timeago small" data-ts="1651503600" > 2022-05-03 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>공부하며 정리하는 인과추론 02</h3><div class="text-muted small"><p> 이 포스트는 개인적으로 공부한 내용을 정리하고 필요한 분들에게 지식을 공유하기 위해 작성되었습니다. 지적하실 내용이 있다면, 언제든 댓글 또는 메일로 알려주시기를 바랍니다. 본 포스트의 상당 내용은 인과추론의 데이터과학 강의를 정리한 것임을 밝힙니다. 지난 이야기 복잡한 IT 환경에서 이상징후 및 장애가 발생되었을 때, 이를 인과추론의 방식...</p></div></div></a></div><div class="card"> <a href="/posts/Causal-Bayesian-Network-01/"><div class="card-body"> <em class="timeago small" data-ts="1651935600" > 2022-05-08 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>(인과추론의 데이터과학) Bayesian Network의 개념</h3><div class="text-muted small"><p> 이 포스트는 개인적으로 공부한 내용을 정리하고 필요한 분들에게 지식을 공유하기 위해 작성되었습니다. 지적하실 내용이 있다면, 언제든 댓글 또는 메일로 알려주시기를 바랍니다. 본 포스트 내용은 인과추론의 데이터과학, 베이지안 네트워크 (Bayesian Network) 강의를 정리한 것임을 밝힙니다. Probability ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Query2Box/" class="btn btn-outline-primary" prompt="Older"><p>Query2Box_Reasoning Over Knowledge Graphs In Vector Space Using Box Embeddings (논문 및 Stanford CS224w 내용 정리)</p></a> <a href="/posts/Bayes'-Theorem/" class="btn btn-outline-primary" prompt="Newer"><p>베이즈 정리 기본 개념</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/zerojsh00">Sanghyeon</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/k8s/">K8S</a> <a class="post-tag" href="/tags/kubernetes/">Kubernetes</a> <a class="post-tag" href="/tags/paper-review/">Paper Review</a> <a class="post-tag" href="/tags/security/">Security</a> <a class="post-tag" href="/tags/network/">Network</a> <a class="post-tag" href="/tags/speech-ai/">Speech AI</a> <a class="post-tag" href="/tags/scheduling/">Scheduling</a> <a class="post-tag" href="/tags/nlp/">NLP</a> <a class="post-tag" href="/tags/storage/">Storage</a> <a class="post-tag" href="/tags/asr/">ASR</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/ko.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
